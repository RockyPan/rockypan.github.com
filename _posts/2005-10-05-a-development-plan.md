---
layout: post
title: 开发计划(2005/10/04)
category: 技术
tags: [其他, 网络]
keywords:
---

## 开发日志(2005/10/04)

这两天的进展比较缓慢。 

完成了消息类的重构，原来的做法是为每一种数据类型提供一个助手类，助手类中有这种数据类型的公有的`get`，`set`方法。有保护的`encode`和`decode`方法。具体的消息类则从`CMessage`公共基类，及多个助手类继承。这种方式的代码冗余量小，但不太灵活，而且我也不太喜欢多重继承。所以还是把它重构了，实现了一个助手类，为每种数据类型提供了一对`encode`和`decode`的静态函数。 

调试一直是比较麻烦的事，要开两个visual studio，还老是在两个调试进程中切换，即不方便又占资源。今天把调试用的客户端包装成一个线程函数。插进服务器端的main函数中，当服务器初始化完成了，就起一个客户端的线程。这样把客户端和服务器端放到一个进程中跑，在一个工程里维护。方便多了。 接下去要做的是：


1. 把上层的消息处理机制用处理器模式实现，消息发到相应的房间，而可以处理该消息的处理器也要被注册到相同的房间，否则消息不被处理，而是分发到责任链上的其他房间。
2. 增加处理登录、注销、不正常断开的处理器。
3. 修改反应器，现在只能接受连接，接收消息。增加处理连接关闭，和非法断开的功能。
4. 增加心跳消息处理。

